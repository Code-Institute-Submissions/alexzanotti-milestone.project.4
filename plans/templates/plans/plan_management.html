{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Plan Management{% endblock %}
{% block image %}Plan Management{% endblock %}

{% block content %}
<h1>Plan Management</h1>

<h2>Categories</h2>
<table class="table table-bordered">
    <thead class="thead-dark">
        <tr>
            <th>Name</th>
            <th class="d-none d-sm-table-cell">Description</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for category in categories %}
        <tr class="category-row" data-href="{% url 'plans:edit_category' category.id %}">
            <td class="break-word">{{ category.name }}</td>
            <td class="break-word d-none d-sm-table-cell">{{ category.description }}</td>
            <td>
                <a href="{% url 'plans:edit_category' category.id %}" class="btn btn-primary">Edit</a>
                <form method="POST" action="{% url 'plans:delete_category' category.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<a href="{% url 'plans:add_category' %}" class="btn btn-primary mb-3">Add Category</a>

<h2>Plans</h2>
<table class="table table-bordered">
    <thead class="thead-dark">
        <tr>
            <th>Name</th>
            <th class="d-none d-sm-table-cell">Category</th>
            <th class="d-none d-md-table-cell">Author</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for plan in plans %}
        <tr data-toggle="collapse" data-target="#plan-detail-{{plan.id}}" class="accordion-toggle">
            <td class="break-word">{{ plan.name }}</td>
            <td class="break-word d-none d-sm-table-cell">{{ plan.category }}</td>
            <td class="break-word d-none d-md-table-cell">{{ plan.author }}</td>
            <td>
                <a href="{% url 'plans:edit_plan' plan.id %}" class="btn btn-primary">Edit</a>
                <a href="{% url 'plans:delete_plan' plan.id %}" class="btn btn-danger">Delete</a>
            </td>
        </tr>
        <tr>
            <td colspan="3" class="hiddenRow">
                <div class="accordion-body collapse" id="plan-detail-{{plan.id}}">
                    <p>Description: {{ plan.description }}</p>
                    {% if plan.image_field %}
                        <img src="{{ plan.image_field.url }}" class="img-thumbnail" alt="{{ plan.name }}">
                    {% else %}
                        <img src="{{ MEDIA_URL }}health.jpeg" class="img-thumbnail" alt="{{ plan.name }}">
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<a href="{% url 'plans:add_plan' %}" class="btn btn-primary mb-3">Add Plan</a>


<h2>Comments</h2>
<table class="table table-bordered">
    <thead class="thead-dark">
        <tr>
            <th>Content</th>
            <th class="d-none d-sm-table-cell">Plan</th>
            <th class="d-none d-md-table-cell">Author</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for comment in comments %}
        <tr>
            <td class="break-word">{{ comment.content }}</td>
            <td class="break-word d-none d-sm-table-cell">{{ comment.plan.name }}</td>
            <td class="break-word d-none d-md-table-cell">{{ comment.author }}</td>
            <td>
                <a href="{% url 'plans:edit_comment' comment.id %}" class="btn btn-primary">Edit</a>
                <a href="{% url 'plans:delete_comment' comment.id %}" class="btn btn-danger">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>


{% endblock %}

{% block endscripts %}
<script>
    $(document).ready(function() {
        $('.category-row').css('cursor', 'pointer');
        $('.category-row').click(function() {
            window.location = $(this).data('href');
        });
    });
</script>
{% endblock %}
